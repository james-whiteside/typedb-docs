= Define query
:Summary: Define schema types and rules with TypeQL.
:keywords: typeql, schema, model, define, modify, extend, type, rule, annotations
:pageTitle: Define query
:page-aliases: {page-component-version}@typeql::schema/define.adoc, {page-component-version}@typeql::type-definitions.adoc, {page-component-version}@typeql::rule-definitions.adoc

A Define query extends the schema of a database with new schema statements. 
For a practical guide on how to send a Define query to TypeDB,
see the xref:{page-component-version}@manual::defining/define.adoc[] page of the TypeDB Manual.

// For more information on the limitations of schema manipulations, see the
// xref:{page-component-version}@home::acid.adoc#_schema_integrity[Schema integrity enforcement].

[#_syntax]
== Syntax

// tag::syntax[]
A Define query consists of a single `define` clause and always starts with the `define` keyword.

Define queries are written in TypeQL with the following syntax:

[,typeql]
----
define <schema_definitions>
----

where `<schema_definitions>` are valid schema-specific TypeQL statements:
xref:{page-component-version}@typeql::statements/sub.adoc[],
xref:{page-component-version}@typeql::statements/abstract.adoc[],
xref:{page-component-version}@typeql::statements/owns.adoc[],
xref:{page-component-version}@typeql::statements/value.adoc[],
xref:{page-component-version}@typeql::statements/regex.adoc[],
xref:{page-component-version}@typeql::statements/relates.adoc[],
xref:{page-component-version}@typeql::statements/plays.adoc[],
xref:{page-component-version}@typeql::statements/rule.adoc[],
and annotations: xref:{page-component-version}@typeql::statements/key.adoc[] and xref:{page-component-version}@typeql::statements/unique.adoc[].
Schema statements in a `define` clause can't use any variables or values, except for xref:{page-component-version}@typeql::statements/rule.adoc[rules].
// end::syntax[]

== Behavior

// tag::behavior[]
A Define query adds schema statements to an existing schema.
These statements can add new types and rules,
or they can add new properties to existing types and replace existing rules.
Define queries can't change schema statements already existing in a schema, except for
xref:{page-component-version}@typeql::statements/overview.adoc#_annotation_statements[annotations] and
xref:{page-component-version}@typeql::statements/rule.adoc[rules].

=== Query execution

Define queries are _idempotent_, meaning they can be applied multiple times
without changing the result of the initial application. 

A Define query must produce a _valid_ schema in a database,
otherwise it will be rejected.

=== Query response

A successful Define query returns a promise of an empty response.
// end::behavior[]


== Define types

To define a new type, subtype an existing type with a xref:{page-component-version}@typeql::statements/sub.adoc[sub] statement.
Use xref:{page-component-version}@typeql::statements/owns.adoc[owns] statements to assign an ability to own attribute types.

For roles on relations, use xref:{page-component-version}@typeql::statements/relates.adoc[relates] and
xref:{page-component-version}@typeql::statements/plays.adoc[plays] statements.

Simple statements about the same subject can be combined in a
xref:{page-component-version}@typeql::statements/overview.adoc#_composite_statements[composite statement].

.Defining types example
[,typeql]
----
define

credential sub attribute, value string;
email sub attribute, value string;
full-name sub attribute, value string;
review-date sub attribute, value datetime;

subject sub entity,
    abstract,
    owns credential,
    plays permission:subject;
user sub subject, abstract;
person sub user,
    owns email,
    owns full-name;

permission sub relation,
    owns review-date,
    relates subject;
----

The above example defines four attribute types, three entity types, and a single relation type.

== Define rules

include::{page-component-version}@typeql::partial$iam-database-links.adoc[]

Use a xref:{page-component-version}@typeql::statements/rule.adoc[rule] statement to define a new rule or replace an existing one:

.Defining a rule example
[,typeql]
----
define

rule add-view-permission: when {
    $modify isa action, has name "modify_file";
    $view isa action, has name "view_file";
    $ac_modify (object: $obj, action: $modify) isa access;
    $ac_view (object: $obj, action: $view) isa access;
    (subject: $subj, access: $ac_modify) isa permission;
} then {
    (subject: $subj, access: $ac_view) isa permission;
};
----

== Learn more

[cols-2]
--
.xref:{page-component-version}@academy::5-defining-schemas/overview.adoc[]
[.clickable]
****
Learn more about defining a schema in TypeDB Academy.
****

.xref:{page-component-version}@manual::defining/define.adoc[]
[.clickable]
****
See how to send a Define query to TypeDB.
****
--
